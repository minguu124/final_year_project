# Migration `20200503095612-init`

This migration has been generated by Minh Nguyen at 5/3/2020, 9:56:12 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `mydb`.`User` (
`coverImage` varchar(191)   ,`coverImagePublicId` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`email` varchar(191) NOT NULL  ,`fullname` varchar(191) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`image` varchar(191)   ,`imagePublicId` varchar(191)   ,`isOnline` boolean NOT NULL DEFAULT false ,`password` varchar(191) NOT NULL  ,`passwordResetToken` varchar(191)   ,`passwordResetTokenExpiry` datetime(3)   ,`updatedAt` datetime(3) NOT NULL  ,`userId` int   ,`username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Post` (
`authorId` int NOT NULL ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`image` varchar(191)   ,`imagePublicId` varchar(191)   ,`title` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Follow` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`followerId` int NOT NULL ,`id` int NOT NULL  AUTO_INCREMENT,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Notification` (
`authorId` int NOT NULL ,`commentId` int  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`followId` int  ,`id` int NOT NULL  AUTO_INCREMENT,`likeId` int  ,`postId` int  ,`seen` boolean NOT NULL DEFAULT false ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Message` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`message` varchar(191) NOT NULL  ,`receiverId` int NOT NULL ,`seen` boolean NOT NULL DEFAULT false ,`senderId` int NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Like` (
`authorId` int NOT NULL ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`postId` int NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Comment` (
`authorId` int NOT NULL ,`comment` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`postId` int NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.email` ON `mydb`.`User`(`email`)

CREATE UNIQUE INDEX `User.username` ON `mydb`.`User`(`username`)

ALTER TABLE `mydb`.`Post` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Follow` ADD FOREIGN KEY (`userId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Follow` ADD FOREIGN KEY (`followerId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`userId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`postId`) REFERENCES `mydb`.`Post`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`likeId`) REFERENCES `mydb`.`Like`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`commentId`) REFERENCES `mydb`.`Comment`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`followId`) REFERENCES `mydb`.`Follow`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Message` ADD FOREIGN KEY (`senderId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Message` ADD FOREIGN KEY (`receiverId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Like` ADD FOREIGN KEY (`postId`) REFERENCES `mydb`.`Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Like` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Comment` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Comment` ADD FOREIGN KEY (`postId`) REFERENCES `mydb`.`Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200501113923-init..20200503095612-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "mysql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -100,9 +100,9 @@
   id        Int      @default(autoincrement()) @id
   comment   String?
   author    User     @relation(fields: [authorId], references: [id])
   authorId  Int
-  post      Post     @relation(fields: [authorId], references: [id])
+  post      Post     @relation(fields: [postId], references: [id])
   postId    Int
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
```


