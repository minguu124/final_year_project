# Migration `20200501113923-init`

This migration has been generated by Minh Nguyen at 5/1/2020, 11:39:23 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `mydb`.`User` (
`coverImage` varchar(191)   ,`coverImagePublicId` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`email` varchar(191) NOT NULL  ,`fullname` varchar(191) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`image` varchar(191)   ,`imagePublicId` varchar(191)   ,`isOnline` boolean NOT NULL DEFAULT false ,`password` varchar(191) NOT NULL  ,`passwordResetToken` varchar(191)   ,`passwordResetTokenExpiry` datetime(3)   ,`updatedAt` datetime(3) NOT NULL  ,`userId` int   ,`username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Post` (
`authorId` int NOT NULL ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`image` varchar(191)   ,`imagePublicId` varchar(191)   ,`title` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Follow` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`followerId` int NOT NULL ,`id` int NOT NULL  AUTO_INCREMENT,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Notification` (
`authorId` int NOT NULL ,`commentId` int  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`followId` int  ,`id` int NOT NULL  AUTO_INCREMENT,`likeId` int  ,`postId` int  ,`seen` boolean NOT NULL DEFAULT false ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Message` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`message` varchar(191) NOT NULL  ,`receiverId` int NOT NULL ,`seen` boolean NOT NULL DEFAULT false ,`senderId` int NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Like` (
`authorId` int NOT NULL ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`postId` int NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `mydb`.`Comment` (
`authorId` int NOT NULL ,`comment` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`postId` int NOT NULL  ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.email` ON `mydb`.`User`(`email`)

CREATE UNIQUE INDEX `User.username` ON `mydb`.`User`(`username`)

ALTER TABLE `mydb`.`Post` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Follow` ADD FOREIGN KEY (`userId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Follow` ADD FOREIGN KEY (`followerId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`userId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`postId`) REFERENCES `mydb`.`Post`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`likeId`) REFERENCES `mydb`.`Like`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`commentId`) REFERENCES `mydb`.`Comment`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Notification` ADD FOREIGN KEY (`followId`) REFERENCES `mydb`.`Follow`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `mydb`.`Message` ADD FOREIGN KEY (`senderId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Message` ADD FOREIGN KEY (`receiverId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Like` ADD FOREIGN KEY (`postId`) REFERENCES `mydb`.`Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Like` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Comment` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `mydb`.`Comment` ADD FOREIGN KEY (`authorId`) REFERENCES `mydb`.`Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200501113923-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,108 @@
+datasource db {
+  provider = "mysql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id                       Int            @default(autoincrement()) @id
+  fullname                 String
+  email                    String         @unique
+  username                 String         @unique
+  passwordResetToken       String?
+  passwordResetTokenExpiry DateTime?
+  password                 String
+  image                    String?
+  imagePublicId            String?
+  coverImage               String?
+  coverImagePublicId       String?
+  isOnline                 Boolean        @default(false)
+  posts                    Post[]
+  likes                    Like[]
+  comments                 Comment[]
+  followers                Follow[]       @relation("FollowingUser")
+  following                Follow[]       @relation("UserFollowing")
+  notifications            Notification[]
+  messages                 Message[]
+  createdAt                DateTime       @default(now())
+  updatedAt                DateTime       @updatedAt
+  userId                   Int?
+}
+
+model Post {
+  id            Int       @default(autoincrement()) @id
+  title         String?
+  image         String?
+  imagePublicId String?
+  author        User      @relation(fields: [authorId], references: [id])
+  authorId      Int
+  likes         Like[]
+  comments      Comment[]
+  createdAt     DateTime  @default(now())
+  updatedAt     DateTime  @updatedAt
+}
+
+model Follow {
+  id         Int      @default(autoincrement()) @id
+  user       User     @relation("FollowingUser", fields: [userId], references: [id])
+  userId     Int
+  follower   User     @relation("UserFollowing", fields: [followerId], references: [id])
+  followerId Int
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+}
+
+model Notification {
+  id        Int      @default(autoincrement()) @id
+  author    User     @relation("NotificationToAuthor", fields: [authorId], references: [id])
+  authorId  Int
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  post      Post?    @relation(fields: [postId], references: [id])
+  postId    Int?
+  like      Like?    @relation(fields: [likeId], references: [id])
+  likeId    Int?
+  comment   Comment? @relation(fields: [commentId], references: [id])
+  commentId Int?
+  follow    Follow?   @relation(fields: [followId], references: [id])
+  followId  Int?
+  seen      Boolean  @default(false)
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Message {
+  id         Int      @default(autoincrement()) @id
+  sender     User     @relation("MessageToSender", fields: [senderId], references: [id])
+  senderId   Int
+  receiver   User     @relation(fields: [receiverId], references: [id])
+  receiverId Int
+  message    String
+  seen       Boolean  @default(false)
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+}
+
+model Like {
+  id        Int      @default(autoincrement()) @id
+  post      Post     @relation(fields: [postId], references: [id])
+  postId    Int
+  author    User     @relation(fields: [authorId], references: [id])
+  authorId  Int
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Comment {
+  id        Int      @default(autoincrement()) @id
+  comment   String?
+  author    User     @relation(fields: [authorId], references: [id])
+  authorId  Int
+  post      Post     @relation(fields: [authorId], references: [id])
+  postId    Int
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```


